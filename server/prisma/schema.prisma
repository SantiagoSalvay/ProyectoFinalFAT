generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TipoUsuario {
  tipo_usuario        Int       @id @default(autoincrement())
  nombre_tipo_usuario String
  usuarios            Usuario[]
}

model Usuario {
  id_usuario                Int                    @id @default(autoincrement())
  nombre                    String
  apellido                  String
  usuario                   String                 @unique
  correo                    String                 @unique
  contrasena                String?
  tipo_usuario              Int
  ubicacion                 String?
  createdAt                 DateTime               @default(now())
  email_verified            Boolean                @default(false)
  reset_token               String?
  reset_token_expiry        DateTime?
  verification_token        String?
  verification_token_expiry DateTime?
  auth_provider             String                 @default("email")
  facebook_id               String?                @unique
  google_id                 String?                @unique
  profile_picture           String?
  twitter_id                String?                @unique
  bio                       String?
  banned_at                 DateTime?
  banned_reason             String?
  banned_until              DateTime?
  is_banned                 Boolean                @default(false)
  warnings_count            Int                    @default(0)
  foros                     Foro[]
  infracciones              ModerationInfraction[]
  pedidos                   PedidoDonacion[]
  rankings                  Ranking[]
  respuestas                RespuestaForo[]
  tiposONG                  TipoONG[]
  likes                     MeGustaForo[]
  tipo                      TipoUsuario            @relation(fields: [tipo_usuario], references: [tipo_usuario])
}

model Foro {
  id_foro         Int              @id @default(autoincrement())
  id_usuario      Int
  titulo          String
  descripcion     String
  fecha           DateTime
  ubicacion       String?
  usuario         Usuario          @relation(fields: [id_usuario], references: [id_usuario])
  foroCategorias  ForoCategoria[]
  pedidosDonacion PedidoDonacion[]
  respuestas      RespuestaForo[]
  likes           MeGustaForo[]
}

model Categoria {
  id_categoria   Int             @id @default(autoincrement())
  etiqueta       String
  foroCategorias ForoCategoria[]
}

model ForoCategoria {
  id_foro_categoria Int              @id @default(autoincrement())
  id_foro           Int
  id_categoria      Int
  categoria         Categoria        @relation(fields: [id_categoria], references: [id_categoria])
  foro              Foro             @relation(fields: [id_foro], references: [id_foro])
  pedidos           PedidoDonacion[]
}

model RespuestaForo {
  id_respuesta      Int       @id @default(autoincrement())
  id_foro           Int
  id_usuario        Int
  mensaje           String
  fecha             DateTime
  moderated_at      DateTime?
  moderation_status String    @default("pending")
  rejection_reason  String?
  foro              Foro      @relation(fields: [id_foro], references: [id_foro])
  usuario           Usuario   @relation(fields: [id_usuario], references: [id_usuario])
}

model Donacion {
  id_donacion   Int              @id @default(autoincrement())
  tipo_donacion String
  descripcion   String
  puntos        Int
  pedidos       PedidoDonacion[]
}

model PedidoDonacion {
  id_pedido         Int           @id @default(autoincrement())
  id_foro_categoria Int
  id_usuario        Int
  id_donacion       Int
  id_foro           Int
  descripcion       String
  cantidad          Int
  fecha             DateTime
  foro              Foro          @relation(fields: [id_foro], references: [id_foro], map: "PedidoDonacion_foro")
  foroCategoria     ForoCategoria @relation(fields: [id_foro_categoria], references: [id_foro_categoria], map: "PedidoDonacion_foroCategoria")
  donacion          Donacion      @relation(fields: [id_donacion], references: [id_donacion])
  usuario           Usuario       @relation(fields: [id_usuario], references: [id_usuario])
  rankings          Ranking[]
}

model Ranking {
  id_ranking      Int            @id @default(autoincrement())
  id_tipo_ranking Int
  id_pedido       Int
  id_usuario      Int
  puesto          Int
  puntos          Int
  pedido          PedidoDonacion @relation(fields: [id_pedido], references: [id_pedido])
  tipoRanking     TipoRanking    @relation(fields: [id_tipo_ranking], references: [id_tipo_ranking])
  usuario         Usuario        @relation(fields: [id_usuario], references: [id_usuario])
}

model TipoRanking {
  id_tipo_ranking Int       @id @default(autoincrement())
  tipo_ranking    String
  rankings        Ranking[]
}

model RegistroPendiente {
  id                 Int      @id @default(autoincrement())
  nombre             String
  apellido           String
  usuario            String
  correo             String   @unique
  contrasena         String
  ubicacion          String?
  verification_token String   @unique
  token_expiry       DateTime
  createdAt          DateTime @default(now())
  tipo_usuario       Int
}

model TipoONG {
  ID_tipo      Int      @id @default(autoincrement())
  grupo_social String?
  necesidad    String?
  usuarioId    Int?
  tipo_ong     String?
  usuario      Usuario? @relation(fields: [usuarioId], references: [id_usuario])
}

model ModerationInfraction {
  id              Int       @id @default(autoincrement())
  user_id         Int
  infraction_type String
  severity        String
  content         String?
  action_taken    String
  created_at      DateTime  @default(now())
  expires_at      DateTime?
  usuario         Usuario   @relation(fields: [user_id], references: [id_usuario])
}

model MeGustaForo {
  id_megusta Int      @id @default(autoincrement())
  id_foro    Int
  id_usuario Int
  fecha      DateTime @default(now())
  foro       Foro     @relation(fields: [id_foro], references: [id_foro], onDelete: Cascade)
  usuario    Usuario  @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade)
  
  @@unique([id_foro, id_usuario])
}
